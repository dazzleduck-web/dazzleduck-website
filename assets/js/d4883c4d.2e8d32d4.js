"use strict";(globalThis.webpackChunkdazzleduck_website=globalThis.webpackChunkdazzleduck_website||[]).push([[8305],{4141:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"dazzleduck-sql-commons/connectionPool","title":"Connection Pool","description":"Embedded DuckDB connection management with Arrow-native streaming support.","source":"@site/docs/dazzleduck-sql-commons/connectionPool.md","sourceDirName":"dazzleduck-sql-commons","slug":"/dazzleduck-sql-commons/connectionPool","permalink":"/dazzleduck-website/docs/dazzleduck-sql-commons/connectionPool","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Connection Pool","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"Overview","permalink":"/dazzleduck-website/docs/dazzleduck-sql-commons/overview"},"next":{"title":"SQL Transformation","permalink":"/dazzleduck-website/docs/dazzleduck-sql-commons/transformation"}}');var s=o(4848),i=o(8453);const l={sidebar_label:"Connection Pool",sidebar_position:2},c="Connection Pool",t={},a=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Execute a Query",id:"execute-a-query",level:3},{value:"Print Results (Debugging)",id:"print-results-debugging",level:3},{value:"Collect a Single Value",id:"collect-a-single-value",level:3},{value:"Arrow Reader",id:"arrow-reader",level:2},{value:"Batch Execution",id:"batch-execution",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Production Notes",id:"production-notes",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"connection-pool",children:"Connection Pool"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Embedded DuckDB connection management with Arrow-native streaming support."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ConnectionPool"})," provides a ",(0,s.jsx)(n.strong,{children:"high-performance, thread-safe"})," way to execute SQL against an embedded DuckDB instance."]}),"\n",(0,s.jsx)(n.p,{children:"Unlike traditional pools, this implementation:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Uses DuckDB's native connection duplication"}),"\n",(0,s.jsx)(n.li,{children:"Streams results via Apache Arrow"}),"\n",(0,s.jsx)(n.li,{children:"Avoids heavy JDBC object creation"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Singleton-managed DuckDB instance"}),"\n",(0,s.jsx)(n.li,{children:"Connection duplication per request"}),"\n",(0,s.jsx)(n.li,{children:"Arrow IPC streaming enabled by default"}),"\n",(0,s.jsx)(n.li,{children:"Automatic statement and reader cleanup"}),"\n",(0,s.jsx)(n.li,{children:"Batch execution helpers"}),"\n",(0,s.jsx)(n.li,{children:"Record mapping utilities"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(n.h3,{id:"execute-a-query",children:"Execute a Query"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'ConnectionPool.execute("SELECT 1");\n'})}),"\n",(0,s.jsx)(n.h3,{id:"print-results-debugging",children:"Print Results (Debugging)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'ConnectionPool.printResult("SELECT * FROM users");\n'})}),"\n",(0,s.jsx)(n.h3,{id:"collect-a-single-value",children:"Collect a Single Value"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'Long count = ConnectionPool.collectFirst("SELECT COUNT(*) FROM t", Long.class);\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"arrow-reader",children:"Arrow Reader"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'try (BufferAllocator allocator = new RootAllocator()) {\n    ArrowReader reader = ConnectionPool.getReader(\n        connection,\n        allocator,\n        "SELECT * FROM users",\n        1000\n    );\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Arrow readers stream data in batches and must always be closed."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"batch-execution",children:"Batch Execution"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'ConnectionPool.executeBatch(new String[] {\n    "CREATE TABLE t(a INT)",\n    "INSERT INTO t VALUES (1)"\n});\n'})}),"\n",(0,s.jsx)(n.p,{children:"Transactional batch execution is also supported."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Properties are loaded from:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"src/main/resources/duckdb.properties\n"})}),"\n",(0,s.jsx)(n.p,{children:"Common options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"duckdb.database=memory\nduckdb.config.threads=4\nduckdb.config.enable_external_access=true\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"production-notes",children:"Production Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Designed for ",(0,s.jsx)(n.strong,{children:"embedded"})," DuckDB only"]}),"\n",(0,s.jsx)(n.li,{children:"Not a network pool"}),"\n",(0,s.jsx)(n.li,{children:"Prefer Arrow readers over ResultSet"}),"\n",(0,s.jsx)(n.li,{children:"Always close readers and connections"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Next: ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/dazzleduck-website/docs/dazzleduck-sql-commons/transformation",children:"Query Transformation \u2192"})})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>c});var r=o(6540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);