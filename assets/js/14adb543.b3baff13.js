"use strict";(globalThis.webpackChunkdazzleduck_website=globalThis.webpackChunkdazzleduck_website||[]).push([[1055],{4614:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"dazzleduck-sql-micrometer/setup","title":"Setup & Configuration","description":"Enable Arrow\u2011based metric ingestion using Micrometer and DazzleDuck SQL Server.","source":"@site/docs/dazzleduck-sql-micrometer/setup.md","sourceDirName":"dazzleduck-sql-micrometer","slug":"/dazzleduck-sql-micrometer/setup","permalink":"/dazzleduck-website/docs/dazzleduck-sql-micrometer/setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Setup & Configuration","sidebar_position":2},"sidebar":"docSidebar","previous":{"title":"Overview","permalink":"/dazzleduck-website/docs/dazzleduck-sql-micrometer/overview"},"next":{"title":"Metric & Arrow Schema","permalink":"/dazzleduck-website/docs/dazzleduck-sql-micrometer/schema"}}');var s=r(4848),t=r(8453);const l={sidebar_label:"Setup & Configuration",sidebar_position:2},o="Setup & Configuration",c={},a=[{value:"Requirements",id:"requirements",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Registry Creation",id:"registry-creation",level:2},{value:"Configuration Source",id:"configuration-source",level:2},{value:"Example Configuration",id:"example-configuration",level:2},{value:"Publishing Model",id:"publishing-model",level:2},{value:"Graceful Shutdown",id:"graceful-shutdown",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"setup--configuration",children:"Setup & Configuration"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Enable Arrow\u2011based metric ingestion using Micrometer and DazzleDuck SQL Server."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Java 21+"}),"\n",(0,s.jsx)(n.li,{children:"Micrometer 1.10+"}),"\n",(0,s.jsx)(n.li,{children:"Running DazzleDuck SQL Server (HTTP ingestion enabled)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsxs)(n.p,{children:["This module provides a ",(0,s.jsxs)(n.strong,{children:["Micrometer ",(0,s.jsx)(n.code,{children:"MeterRegistry"})]})," that periodically publishes metric snapshots as ",(0,s.jsx)(n.strong,{children:"Apache Arrow"})," rows and ingests them into DazzleDuck SQL Server over HTTP."]}),"\n",(0,s.jsxs)(n.p,{children:["Registry creation and wiring is ",(0,s.jsx)(n.strong,{children:"configuration\u2011driven"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"registry-creation",children:"Registry Creation"}),"\n",(0,s.jsx)(n.p,{children:"Create and register the Arrow\u2011backed registry using the factory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"MeterRegistry registry = MetricsRegistryFactory.create();\n\nMetrics.addRegistry(registry);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This returns a ",(0,s.jsx)(n.code,{children:"CompositeMeterRegistry"})," that contains an ",(0,s.jsx)(n.code,{children:"ArrowMicroMeterRegistry"})," instance."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-source",children:"Configuration Source"}),"\n",(0,s.jsxs)(n.p,{children:["All settings are loaded from ",(0,s.jsx)(n.strong,{children:"Typesafe Config"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"dazzleduck_micrometer { ... }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Configuration can be provided via:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"application.conf"})}),"\n",(0,s.jsx)(n.li,{children:"Environment variables"}),"\n",(0,s.jsx)(n.li,{children:"JVM system properties"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:'dazzleduck_micrometer {\n  application_id   = "orders-service"\n  application_name = "orders"\n  application_host = "host-1"\n\n  http {\n    base_url = "http://localhost:8081"\n    target_path = "/v1/ingest"\n    username = "admin"\n    password = "admin"\n    http_client_timeout_ms = 5000\n  }\n\n  max_in_memory_bytes = 10485760   # 10 MB\n  max_on_disk_bytes   = 1073741824 # 1 GB\n\n  min_batch_size = 1048576 # 1 MB\n  max_batch_size = 16777216 # 16 MB\n  max_send_interval_ms = 1000\n\n  retry_count = 3\n  retry_interval_ms = 1000\n  transformations = []\n  partition_by = []\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"publishing-model",children:"Publishing Model"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Metrics are published on a ",(0,s.jsx)(n.strong,{children:"fixed step interval"})," (default: 10s)"]}),"\n",(0,s.jsxs)(n.li,{children:["Each publish cycle sends a ",(0,s.jsx)(n.strong,{children:"snapshot"})," of all meters"]}),"\n",(0,s.jsx)(n.li,{children:"Publishing is non\u2011blocking and failure\u2011tolerant"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"graceful-shutdown",children:"Graceful Shutdown"}),"\n",(0,s.jsx)(n.p,{children:"Always close the registry on application shutdown:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"registry.close();\n"})}),"\n",(0,s.jsx)(n.p,{children:"This ensures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Final metric flush"}),"\n",(0,s.jsx)(n.li,{children:"Sender shutdown"}),"\n",(0,s.jsx)(n.li,{children:"Resource cleanup"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Next: ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/dazzleduck-website/docs/dazzleduck-sql-micrometer/schema",children:"Metric Schema \u2192"})})]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);